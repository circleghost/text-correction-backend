---
task_id: 002
title: Authentication Core
epic: Auth + Usage Tracking
status: pending
assignee: 
priority: high
effort: M
parallel: false
depends_on: [001]
created: 2025-09-13T03:59:42Z
updated: 2025-09-13T04:13:43Z
---

# Task 002: Authentication Core

## Overview
Implement the complete authentication system including React frontend components for login/logout, Express.js backend JWT middleware, session management, and basic user profile interface. This task builds upon the database and auth setup from Task 001.

## Scope
- React authentication components and flows
- Backend JWT middleware and session management
- User profile management interface
- Authentication state management in frontend
- Protected route implementation

## Acceptance Criteria

### Frontend Authentication Components
- [ ] Create `LoginButton` component with Google OAuth integration
  - Styled with Tailwind CSS to match application design
  - Shows loading state during authentication
  - Handles authentication errors gracefully
  - Redirects to appropriate page after login

- [ ] Create `LogoutButton` component
  - Confirms logout action with user
  - Clears all authentication state
  - Redirects to home page after logout

- [ ] Create `AuthGuard` component for protected routes
  - Checks authentication status
  - Redirects unauthenticated users to login
  - Shows loading spinner while checking auth status

- [ ] Create `UserProfile` component
  - Displays user information (name, email, avatar)
  - Shows account creation date and last login
  - Provides logout functionality
  - Basic profile editing capabilities

### Backend Authentication Middleware
- [ ] Implement JWT middleware (`authMiddleware.js`)
  - Validates Supabase JWT tokens
  - Extracts user information from token
  - Handles token expiration gracefully
  - Provides user context to protected routes

- [ ] Create authentication utility functions
  - `verifySupabaseJWT()` - validates JWT tokens
  - `getUserFromToken()` - extracts user data
  - `requireAuth()` - middleware wrapper for protected routes

- [ ] Implement user session endpoints
  - `GET /api/auth/me` - get current user info
  - `POST /api/auth/refresh` - refresh expired tokens
  - `POST /api/auth/logout` - server-side logout cleanup

### Frontend State Management
- [ ] Create authentication context (`AuthContext`)
  - Manages authentication state globally
  - Provides login/logout functions
  - Handles token refresh automatically
  - Persists authentication state across page reloads

- [ ] Implement authentication hooks
  - `useAuth()` - access auth context
  - `useUser()` - get current user data
  - `useAuthGuard()` - protect components/pages

### Route Protection
- [ ] Update frontend routing to include protected routes
  - Wrap sensitive pages with `AuthGuard`
  - Implement redirect logic for unauthenticated users
  - Handle authentication state changes during navigation

- [ ] Update backend routes with authentication
  - Apply `authMiddleware` to protected endpoints
  - Return appropriate error codes for unauthorized access
  - Implement role-based access if needed

### User Profile Management
- [ ] Create user profile page (`/profile`)
  - Display user information and statistics
  - Allow basic profile updates (name, preferences)
  - Show usage history and account details
  - Provide account management options

- [ ] Implement profile update functionality
  - Frontend form for profile editing
  - Backend endpoint for profile updates
  - Validation for profile data
  - Update authentication state after changes

## Technical Implementation Details

### Frontend Architecture
- Use React Context for global authentication state
- Implement Supabase client configuration
- Handle authentication redirects and deep linking
- Manage token refresh and expiration
- Provide loading states and error handling

### Backend Integration
- Integrate with Supabase Auth for token validation
- Implement proper error handling for auth failures
- Set up CORS for authentication endpoints
- Add request logging for authentication events

### Security Considerations
- Validate all JWT tokens server-side
- Implement proper CORS policies
- Use secure HTTP-only cookies where appropriate
- Sanitize user input in profile updates
- Implement rate limiting for auth endpoints

### Testing Requirements
- [ ] Unit tests for authentication components
- [ ] Integration tests for auth flow
- [ ] Test token refresh functionality
- [ ] Verify protected route behavior
- [ ] Test authentication middleware
- [ ] Validate error handling scenarios

## Deliverables
1. Complete React authentication components
2. Backend JWT middleware and utilities
3. Authentication context and state management
4. Protected routes implementation
5. User profile management interface
6. Unit and integration tests
7. Documentation for authentication flow

## Dependencies
- Requires completion of Task 001 (Database & Auth Setup)
- Supabase project must be configured
- Google OAuth must be working

## API Endpoints

### Backend Endpoints
```
GET    /api/auth/me           - Get current user
POST   /api/auth/refresh      - Refresh JWT token
POST   /api/auth/logout       - Server-side logout
GET    /api/user/profile      - Get user profile
PUT    /api/user/profile      - Update user profile
```

### Frontend Routes
```
/login                       - Login page
/profile                     - User profile page
/dashboard                   - Protected dashboard (example)
```

## Component Structure
```
src/
  components/
    auth/
      LoginButton.jsx
      LogoutButton.jsx
      AuthGuard.jsx
      UserProfile.jsx
  contexts/
    AuthContext.jsx
  hooks/
    useAuth.js
    useUser.js
    useAuthGuard.js
  pages/
    Login.jsx
    Profile.jsx
```

## Risks & Mitigation
- **Risk**: Token refresh failures causing user logout
  - **Mitigation**: Implement robust error handling and retry logic

- **Risk**: Authentication state synchronization issues
  - **Mitigation**: Use React Context properly and test state changes

- **Risk**: Security vulnerabilities in JWT handling
  - **Mitigation**: Follow Supabase best practices and validate all tokens

## Notes
- Follow existing code patterns in the application
- Ensure authentication UI matches the overall design system
- Consider implementing remember me functionality
- Plan for future features like role-based permissions
- Document the authentication flow for other developers