---
task_id: 001
title: Database & Auth Setup
epic: Auth + Usage Tracking
status: closed
assignee: 
priority: high
effort: L
parallel: false
depends_on: []
created: 2025-09-13T03:59:42Z
updated: 2025-09-13T13:49:13Z
---

# Task 001: Database & Auth Setup

## Overview
Foundation task that establishes the complete authentication infrastructure including Supabase project setup, Google OAuth configuration, database schema creation, and Row Level Security (RLS) policies. This task creates the backbone for user authentication and data security.

## Scope
- Supabase project creation and configuration
- Google OAuth provider setup
- Database schema design and implementation
- Row Level Security (RLS) policies
- Environment configuration for both frontend and backend

## Acceptance Criteria

### Supabase Project Setup
- [ ] Create new Supabase project for text correction application
- [ ] Configure project settings and region
- [ ] Set up API keys and environment variables
- [ ] Configure database connection strings

### Google OAuth Configuration
- [ ] Create Google Cloud Console project
- [ ] Configure OAuth 2.0 credentials
- [ ] Set authorized redirect URIs for both development and production
- [ ] Enable Google+ API and required scopes
- [ ] Configure OAuth consent screen
- [ ] Add Google OAuth provider in Supabase Auth settings

### Database Schema
- [ ] Create `users` table with proper fields:
  - `id` (UUID, primary key)
  - `email` (text, unique)
  - `full_name` (text)
  - `avatar_url` (text, nullable)
  - `google_id` (text, unique, nullable)
  - `created_at` (timestamp with timezone)
  - `updated_at` (timestamp with timezone)
  - `last_sign_in_at` (timestamp with timezone, nullable)

- [ ] Create `usage_tracking` table:
  - `id` (UUID, primary key)
  - `user_id` (UUID, foreign key to users.id)
  - `action_type` (text) - 'correction_request', 'text_processed', etc.
  - `text_length` (integer)
  - `tokens_used` (integer, nullable)
  - `created_at` (timestamp with timezone)
  - `metadata` (jsonb, nullable)

- [ ] Create indexes for performance:
  - Index on `users.email`
  - Index on `users.google_id`
  - Index on `usage_tracking.user_id`
  - Index on `usage_tracking.created_at`

### Row Level Security (RLS) Policies
- [ ] Enable RLS on all tables
- [ ] Create policy for `users` table:
  - Users can only read/update their own profile
  - Insert allowed for authenticated users
  - No delete permissions for regular users

- [ ] Create policy for `usage_tracking` table:
  - Users can only read their own usage data
  - Insert allowed for authenticated users
  - No update/delete permissions for regular users

### Environment Configuration
- [ ] Update backend `.env` file with Supabase credentials:
  - `SUPABASE_URL`
  - `SUPABASE_SERVICE_ROLE_KEY`
  - `SUPABASE_ANON_KEY`
  - `GOOGLE_CLIENT_ID`
  - `GOOGLE_CLIENT_SECRET`

- [ ] Update frontend environment variables:
  - `VITE_SUPABASE_URL`
  - `VITE_SUPABASE_ANON_KEY`

## Technical Implementation Details

### Database Migrations
Create SQL migration files that can be run via Supabase CLI or dashboard:
- Initial schema creation
- RLS policy setup
- Index creation
- Trigger functions for `updated_at` timestamps

### Security Considerations
- Use UUID for all primary keys to prevent enumeration
- Implement proper RLS policies to prevent data leakage
- Store only necessary user information from Google OAuth
- Set up proper CORS policies for frontend access

### Testing Requirements
- [ ] Verify database connection from backend
- [ ] Test RLS policies work correctly
- [ ] Validate Google OAuth flow in Supabase Auth
- [ ] Confirm environment variables are loaded properly

## Deliverables
1. Configured Supabase project with all settings
2. Database schema with tables, indexes, and RLS policies
3. Google OAuth provider configured and tested
4. Environment configuration files updated
5. Documentation of database structure and policies
6. Verification that all connections work properly

## Dependencies
None - this is a foundation task

## Risks & Mitigation
- **Risk**: Google OAuth configuration issues
  - **Mitigation**: Follow Google Cloud Console setup guide carefully, test in development first

- **Risk**: RLS policies too restrictive or permissive
  - **Mitigation**: Test policies thoroughly with different user scenarios

- **Risk**: Database performance issues
  - **Mitigation**: Proper indexing strategy and query optimization

## Notes
- This task must be completed before any authentication features can be implemented
- All credentials should be stored securely and not committed to version control
- Consider setting up separate Supabase projects for development and production
- Document the database schema for future reference